# Release v1.1.0 - Code Quality & UX Improvements

**Release Date**: 2026-01-17
**Type**: Minor Release (Bug Fixes & Enhancements)

---

## üìã Overview

Rilis ini fokus pada perbaikan bug, peningkatan kualitas kode, dan konsistensi UI/UX berdasarkan hasil code review komprehensif pada folder `frontend/src`.

---

## üêõ Bug Fixes

### 1. useFileAttachment Memory Leak (Critical)

**File**: `src/hooks/useFileAttachment.ts`

**Problem**:

- Cleanup effect menggunakan `files` state langsung dalam dependency array
- Ini menyebabkan stale closure dimana cleanup function mereferensi array files lama

**Solution**:

- Menggunakan `useRef` untuk tracking files yang akan di-cleanup
- Menambahkan initialization handling untuk initial files
- Menambahkan `isProcessing` state untuk tracking async operations

**Impact**: Prevents memory leaks dari blob URLs yang tidak di-revoke

---

### 2. useSortableData Missing Date Sorting

**File**: `src/hooks/useSortableData.ts`

**Problem**:

- Hook tidak mendeteksi dan sorting date strings dengan benar
- ISO date strings diperlakukan sebagai regular strings

**Solution**:

- Menambahkan `isDateString` type guard untuk mendeteksi ISO dates
- Menambahkan handling untuk Date objects
- Menggunakan `localeCompare` dengan locale 'id' untuk Indonesian sorting
- Menambahkan `resetSort` function

**Impact**: Tanggal sekarang ter-sort dengan benar secara kronologis

---

### 3. StatusBadge Missing Status Mappings

**File**: `src/components/ui/StatusBadge.tsx`

**Problem**:

- Beberapa status baru tidak di-handle (IN_CUSTODY, CONSUMED)
- Matching logic kurang comprehensive

**Solution**:

- Menambahkan `slate` intent untuk consumed states
- Menambahkan `purple` intent untuk custody states
- Enhanced matching logic dengan lebih banyak keywords
- Menambahkan size `lg` variant
- Menambahkan `whitespace-nowrap` dan `truncate` untuk text handling

**Impact**: Semua status sekarang menampilkan badge dengan warna yang tepat

---

### 4. CustomSelect Missing Keyboard Navigation (Accessibility)

**File**: `src/components/ui/CustomSelect.tsx`

**Problem**:

- Tidak ada keyboard navigation (Arrow keys, Enter, Escape)
- Missing ARIA attributes untuk accessibility

**Solution**:

- Menambahkan complete keyboard navigation handler
- Menambahkan highlighted index state dengan visual feedback
- Menambahkan proper ARIA attributes (`aria-label`, `aria-activedescendant`, `role`)
- Scroll into view untuk highlighted option
- Support untuk disabled options

**Impact**: Component sekarang fully accessible via keyboard

---

### 5. useGenericFilter Array Filter Values

**File**: `src/hooks/useGenericFilter.ts`

**Problem**:

- Filter dengan array values tidak di-handle dengan benar
- Empty arrays tidak di-skip

**Solution**:

- Menambahkan check untuk empty arrays di filter logic
- Menambahkan `setFilters` untuk batch updates
- Menambahkan `resetAll` untuk reset filters dan search
- Menambahkan `hasActiveFilters` boolean helper
- Improved type definitions dengan explicit interface

**Impact**: Multi-select filters sekarang bekerja dengan benar

---

## ‚ú® New Components

### 1. ErrorBoundary

**File**: `src/components/ui/ErrorBoundary.tsx`

Komponen untuk graceful error handling yang mencegah crash seluruh aplikasi.

**Features**:

- Menangkap errors di child components
- Menampilkan fallback UI yang user-friendly
- Development-only error details
- Reset dan reload options
- HOC `withErrorBoundary` untuk easy wrapping

**Usage**:

```tsx
<ErrorBoundary>
  <ComponentYangMungkinError />
</ErrorBoundary>;

// Atau dengan HOC
const SafeComponent = withErrorBoundary(UnsafeComponent);
```

---

### 2. EmptyState

**File**: `src/components/ui/EmptyState.tsx`

Komponen unified untuk menampilkan empty states yang konsisten.

**Variants**:

- `default`: Standard empty state
- `search`: Untuk hasil pencarian kosong
- `error`: Untuk error states
- `minimal`: Compact version

**Specialized Components**:

- `SearchEmptyState`: Untuk hasil pencarian kosong dengan query display
- `TableEmptyState`: Untuk tabel kosong dengan optional add action

**Usage**:

```tsx
<EmptyState
  title="Tidak ada data"
  description="Belum ada data tersedia"
  action={{ label: "Tambah Baru", onClick: handleAdd }}
/>

<SearchEmptyState query={searchQuery} onClear={() => setQuery('')} />
```

---

### 3. ConfirmDialog

**File**: `src/components/ui/ConfirmDialog.tsx`

Modal konfirmasi untuk aksi berbahaya atau penting.

**Variants**:

- `danger`: Untuk delete actions (red theme)
- `warning`: Untuk warning actions (amber theme)
- `info`: Untuk informational confirmations (blue theme)

**Features**:

- Animated enter/exit
- Keyboard support (Escape to close, Enter to confirm)
- Optional text confirmation input untuk extra security
- Loading state support
- Proper focus management

**Usage**:

```tsx
<ConfirmDialog
  isOpen={isDeleteOpen}
  onClose={() => setIsDeleteOpen(false)}
  onConfirm={handleDelete}
  title="Hapus Item?"
  message="Aksi ini tidak dapat dibatalkan."
  variant="danger"
  requireConfirmation={true}
  confirmationText="HAPUS"
/>
```

---

## üì¶ Utility Enhancements

### statusUtils.ts

**New Functions**:

- `getLoanRequestStatusClass()`: CSS classes untuk LoanRequestStatus
- `getReturnStatusClass()`: CSS classes untuk AssetReturnStatus
- `getStatusLabel()`: User-friendly labels untuk semua status

**Updates**:

- Added AWAITING_RETURN, CONSUMED status handling di getAssetStatusClass
- Complete coverage untuk semua enum values

---

## üìù Code Quality Improvements

### Performance Optimizations

- Menggunakan `useCallback` untuk handler functions di CustomSelect
- Menggunakan `useRef` untuk prevent unnecessary re-renders di useFileAttachment
- Menggunakan `useMemo` dengan proper dependencies

### Type Safety

- Added explicit interface definitions
- Better type inference dengan proper generics
- Added JSDoc comments dengan usage examples

### Accessibility

- Added ARIA attributes ke CustomSelect
- Added proper role attributes
- Added keyboard navigation support

---

## üîÑ Migration Guide

### Jika menggunakan useFileAttachment

Hook sekarang mengembalikan `isProcessing` state:

```tsx
// Before
const {
  files,
  errors,
  addFiles,
  removeFile,
  clearFiles,
  processAttachmentsForSubmit,
} = useFileAttachment();

// After
const {
  files,
  errors,
  isProcessing,
  addFiles,
  removeFile,
  clearFiles,
  processAttachmentsForSubmit,
} = useFileAttachment();
```

### Jika menggunakan useSortableData

Hook sekarang mengembalikan `resetSort` function:

```tsx
// Before
const { items, requestSort, sortConfig } = useSortableData(data);

// After
const { items, requestSort, sortConfig, resetSort } = useSortableData(data);
```

### Jika menggunakan useGenericFilter

Hook sekarang mengembalikan tambahan properties:

```tsx
// Before
const {
  filteredData,
  searchQuery,
  setSearchQuery,
  activeFilters,
  setFilter,
  resetFilters,
  activeFilterCount,
} = useGenericFilter(config);

// After
const {
  filteredData,
  searchQuery,
  setSearchQuery,
  activeFilters,
  setFilter,
  setFilters, // NEW: Batch filter update
  resetFilters,
  resetAll, // NEW: Reset all including search
  activeFilterCount,
  hasActiveFilters, // NEW: Boolean helper
} = useGenericFilter(config);
```

---

## üìä Impact Analysis

| Area                 | Impact Level | Description                            |
| -------------------- | ------------ | -------------------------------------- |
| Memory Management    | üî¥ High      | Fixed memory leak di file attachments  |
| Accessibility        | üü† Medium    | Improved keyboard navigation & ARIA    |
| UX Consistency       | üü¢ Low       | Unified empty states & confirm dialogs |
| Developer Experience | üü¢ Low       | Better TypeScript types & docs         |

---

## üß™ Testing Recommendations

1. Test file upload dengan multiple files dan verify cleanup saat unmount
2. Test sorting tabel dengan kolom tanggal
3. Test keyboard navigation di semua CustomSelect instances
4. Test filter dengan multi-select values
5. Verify StatusBadge rendering untuk semua status types

---

## üìö Related Documentation

- [Coding Standards](../03_STANDARDS_AND_PROCEDURES/CODING_STANDARDS.md)
- [Frontend Guide](../02_DEVELOPMENT_GUIDES/FRONTEND_GUIDE.md)
- [Component API Spec](../03_STANDARDS_AND_PROCEDURES/COMPONENT_API_SPEC.md)
